<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seu Carrinho</title>
<link rel="stylesheet" href="cart.css">
</head>
<body>

<header>
  <h1>Seu Carrinho</h1>
  <a href="commerce.html">← Voltar para a loja</a>
</header>

<main class="cart-main">
  <div id="cart-items"></div>

  <h3>Total: R$ <span id="total-value">0.00</span></h3>

  <button id="checkout-btn">Finalizar Pagamento</button>
</main>

<script src="carrinho.js"></script>

<script>

// ---------------------
//   FUNÇÃO PARA MOSTRAR O CARRINHO
// ---------------------
function loadCartPage() {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    const container = document.getElementById("cart-items");
    const totalValueEl = document.getElementById("total-value");

    container.innerHTML = "";

    let total = 0;

    cart.forEach((item, index) => {
        const itemTotal = item.qty * item.price;
        total += itemTotal;

        const div = document.createElement("div");
        div.classList.add("cart-item");

        div.innerHTML = `
            <img src="${item.img}" class="cart-img">

            <div class="cart-info">
                <h4>${item.name}</h4>
                <p>Preço: R$ ${item.price.toFixed(2)}</p>
                <p>Quantidade: ${item.qty}</p>
                <p>Subtotal: R$ ${itemTotal.toFixed(2)}</p>

                <button class="remove-one" data-index="${index}">Remover 1</button>
            </div>
        `;

        container.appendChild(div);
    });

    totalValueEl.textContent = total.toFixed(2);

    // botão remover 1
    document.querySelectorAll(".remove-one").forEach(btn => {
        btn.addEventListener("click", () => {
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            const i = btn.getAttribute("data-index");

            if (cart[i].qty > 1) {
                cart[i].qty -= 1;
            } else {
                cart.splice(i, 1);
            }

            localStorage.setItem("cart", JSON.stringify(cart));
            loadCartPage(); // atualizar
        });
    });
}

// Carregar carrinho ao abrir a página
loadCartPage();


// ---------------------
//   FINALIZAR PAGAMENTO
// ---------------------
document.getElementById('checkout-btn').addEventListener('click', () => {
  
  const total = document.getElementById('total-value').textContent;

  // SALVA O TOTAL PARA A PRÓXIMA PÁGINA
  localStorage.setItem("totalCompra", total);

  // REDIRECIONA PARA A PÁGINA entrega.html
  window.location.href = "entrega.html";

});

</script>

</body>
</html>
